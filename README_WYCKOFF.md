# 威克夫交易策略文档

## 📖 威克夫理论简介

威克夫交易法（Wyckoff Method）由理查德·威克夫（Richard Wyckoff）在20世纪初期创立，是一套基于**量价关系分析市场主力意图**的经典交易方法。该方法通过观察价格和成交量的关系，识别主力机构的吸筹和派发行为，从而捕捉最佳的买卖时机。

### 威克夫三大基本定律

1. **供需法则（Law of Supply and Demand）**
   - 需求大于供给 → 价格上涨
   - 供给大于需求 → 价格下跌

2. **因果法则（Law of Cause and Effect）**
   - 吸筹量（原因）决定上涨空间（结果）
   - 派发量（原因）决定下跌幅度（结果）
   - 横盘时间越长，后续运动空间越大

3. **努力与结果法则（Law of Effort vs Result）**
   - 成交量（努力）应与价格变动（结果）相匹配
   - **量价背离**是关键交易信号：
     - 放量不涨 → 主力派发（卖出信号）
     - 缩量不跌 → 主力吸筹（买入信号）

### 市场四个阶段

```
吸筹期 ──────→ 上涨期 ──────→ 派发期 ──────→ 下跌期
(Accumulation)   (Markup)    (Distribution)  (Markdown)
      ↓                              ↓
   建仓完成                       出货完成
      ↓                              ↓
   开始拉升                       开始下跌
```

---

## 🎯 Sequoia威克夫策略实现

本项目实现了四个基于威克夫理论的选股策略，分别对应不同的市场阶段和交易信号。

### 策略一：威克夫弹簧策略 (Wyckoff Spring)

**文件：** `strategy/wyckoff_spring.py`

**策略定位：** ⭐⭐⭐⭐⭐（最经典，信号最清晰）

#### 理论背景

"弹簧"（Spring）是威克夫理论中最著名的买入信号之一，出现在吸筹阶段的末期。主力故意制造一次向下假突破，让散户恐慌性抛售，自己趁机完成最后的吸筹。当价格快速收回时，说明主力吸筹完成，准备开始拉升。

#### 形态特征

```
价格
 │     ┌───横盘整理区───┐
 │     │               │  ↗ 放量突破
 │─────┤               ├──→
 │     │               │
 │     └───────────────┘
 │          ↓↑ 弹簧
 │          假突破后快速收回
 └──────────────────────────→ 时间
        成交量萎缩        放量
```

#### 策略逻辑

1. **横盘识别**：前期有30天以上的横盘整理区间，振幅在5%-15%之间
2. **假突破**：向下跌破箱体底部（约2%），但成交量不大（说明不是真恐慌）
3. **快速收回**：1-3天内快速收回到箱体内（说明主力护盘）
4. **放量突破**：随后放量上涨，涨幅>2%，成交量>均量1.3倍

#### 参数说明

- `threshold=60`: 需要至少60天的历史数据
- 横盘振幅：5%-15%（太窄说明没吸筹，太宽说明不稳定）
- 假突破幅度：跌破箱体底部2%以内
- 确认涨幅：>2%且放量

#### 使用建议

- **风险等级**：中等
- **持有周期**：短中线（1-3周）
- **成功率**：较高（经典形态，主力吸筹完成）
- **注意事项**：
  - 假突破时成交量不能太大（否则可能是真跌破）
  - 必须快速收回（慢收回说明主力不够强）
  - 最好配合大盘环境（牛市成功率更高）

---

### 策略二：威克夫量价背离策略 (Wyckoff Divergence)

**文件：** `strategy/wyckoff_divergence.py`

**策略定位：** ⭐⭐⭐⭐（实用性强，信号较多）

#### 理论背景

"努力与结果法则"是威克夫理论的核心。当成交量（努力）与价格变动（结果）不匹配时，往往预示着趋势即将反转：

- **缩量不跌**：价格不跌但成交量萎缩 → 卖压耗尽，主力吸筹完成（买入信号）
- **放量不涨**：价格滞涨但成交量放大 → 主力派发出货（卖出信号）

本策略主要识别"缩量不跌"作为买入信号。

#### 形态特征

```
价格
 │         ┌─────平台────┐
 │         │  缩量横盘    │  ↗ 随后启动
 │─────────┤             ├───→
 │         └─────────────┘
 │
 └────────────────────────────→ 时间
成交量
 │ ███        ██  █  █  █  ████
 │             ↑ 成交量萎缩
```

#### 策略逻辑

1. **价格位置**：当前价格高于20日均线（不在下跌趋势中）
2. **成交量萎缩**：最近5天中至少3天成交量<均量的80%
3. **价格稳定**：最近5天中至少4天涨跌幅在±3%以内
4. **向上意愿**：最后一天收盘价≥开盘价（有向上意愿）

#### 参数说明

- `threshold=60`: 需要至少60天的历史数据
- 成交量萎缩标准：<20日均量的80%
- 价格稳定标准：涨跌幅在±3%以内

#### 使用建议

- **风险等级**：低-中等
- **持有周期**：中线（2-4周）
- **成功率**：中高（但需要耐心等待启动）
- **注意事项**：
  - 信号出现后不一定立即启动，可能还要整理
  - 建议分批建仓
  - 止损设在整理区间的低点下方

#### 辅助功能：放量不涨预警

策略中还包含了 `check_volume_no_rise()` 函数，可识别"放量不涨"作为卖出预警：

- 连续2天以上成交量放大（>均量1.5倍）
- 但价格涨幅<3%或收阴线
- 说明主力可能在高位派发

---

### 策略三：威克夫SC反弹策略 (Wyckoff Selling Climax)

**文件：** `strategy/wyckoff_selling_climax.py`

**策略定位：** ⭐⭐⭐（激进型，风险较高但收益快）

#### 理论背景

Selling Climax（卖出高潮）是吸筹阶段的关键特征。当市场出现恐慌性抛售时，散户大量止损，主力趁机在底部吸筹。经典的SC-AR-ST模式是威克夫吸筹阶段的标准流程。

#### 形态特征（SC-AR-ST模式）

```
价格
 │         AR
 │        ╱ ╲ 自动反弹         ↗ 开始上涨
 │       ╱   ╲     ST        ╱
 │──────╱     ╲──╱  ╲──────╱
 │                ╲╱ 二次测试
 │      SC ↓
 │     放量大跌
 └──────────────────────────────→ 时间
成交量
 │      ███                 ██
 │       ↑                  ↑
 │      SC放量            突破放量
 │         █  ██  █
 │              ↑
 │           ST缩量
```

#### 策略逻辑

1. **SC识别**：跌幅>7%，成交量>20日均量的2倍（恐慌性抛售）
2. **AR确认**：1-3天内快速反弹，单日涨幅>5%（主力吸筹后自然反弹）
3. **ST确认**：再次测试SC低点（±5%范围内），但成交量萎缩至SC的60%以下（确认底部）
4. **启动信号**：最近3天开始向上，涨幅>2%，当前价格已脱离底部5%以上

#### 参数说明

- `threshold=60`: 需要至少60天的历史数据
- SC标准：跌幅>7%，成交量>均量2倍
- AR标准：涨幅>5%
- ST标准：接近SC低点±5%，成交量<SC的60%

#### 使用建议

- **风险等级**：高（抄底策略，风险较大）
- **持有周期**：短中线（1-2周）
- **成功率**：中等（需要准确判断是否真底部）
- **注意事项**：
  - ⚠️ 这是抄底策略，风险较高
  - 必须确认ST（二次测试）出现，否则可能继续下跌
  - 建议配合大盘环境，不要在熊市使用
  - 严格止损，跌破ST低点应止损
  - 适合激进型投资者

---

### 策略四：威克夫吸筹完成策略 (Wyckoff Accumulation)

**文件：** `strategy/wyckoff_accumulation.py`

**策略定位：** ⭐⭐⭐⭐（稳健型，适合中长线）

#### 理论背景

吸筹区（Accumulation Phase）是威克夫理论的核心概念。主力在底部区域长期横盘吸筹，建立足够的仓位后才会拉升。根据"因果法则"，横盘时间越长（原因），后续上涨空间越大（结果）。

#### 形态特征

```
价格
 │
 │     ┌──────长期横盘60天──────┐
 │     │ 成交量逐渐萎缩          │  ↗↗↗ 放量突破
 │─────┤   箱体振幅10-25%       ├────→
 │     │                        │      开始拉升
 │     └────────────────────────┘
 │
 └──────────────────────────────────→ 时间
成交量
 │ ████  ███  ██  █  █  █  ████
 │  ↑前期成交活跃  ↑萎缩   ↑突破放量
```

#### 策略逻辑

1. **长期横盘**：前60天价格在箱体内波动，振幅在10%-25%之间
   - 太窄（<10%）：说明没有吸筹
   - 太宽（>25%）：说明不稳定
2. **成交量萎缩**：后期成交量<前期的70%（主力吸筹完成，散户不再交易）
3. **放量突破**：突破箱体顶部，涨幅>3%，成交量>均量1.5倍（主力开始拉升）

#### 参数说明

- `threshold=90`: 需要至少90天的历史数据
- 横盘期：60天
- 箱体振幅：10%-25%
- 成交量萎缩比：后20天均量<前20天均量的70%
- 突破条件：涨幅>3%，成交量>均量1.5倍

#### 使用建议

- **风险等级**：低-中等
- **持有周期**：中长线（1-3个月）
- **成功率**：较高（充分吸筹后的突破）
- **注意事项**：
  - 横盘时间越长，后续空间越大
  - 突破后可能回踩箱体顶部，回踩不破是加仓机会
  - 建议在突破当天或回踩时买入
  - 止损设在箱体顶部下方3-5%
  - 适合稳健型投资者

---

## 📊 策略对比与选择

| 策略 | 风险等级 | 持有周期 | 信号频率 | 成功率 | 适合人群 |
|------|---------|---------|---------|--------|---------|
| **弹簧策略** | 中等 | 短中线(1-3周) | 较少 | 较高 | 进取型 |
| **量价背离** | 低-中等 | 中线(2-4周) | 较多 | 中高 | 稳健型 |
| **SC反弹** | 高 | 短中线(1-2周) | 少 | 中等 | 激进型 |
| **吸筹完成** | 低-中等 | 中长线(1-3月) | 较少 | 较高 | 稳健型 |

### 推荐组合

1. **稳健组合**：量价背离 + 吸筹完成
   - 风险低，信号相对较多
   - 适合中长线持有

2. **进取组合**：弹簧策略 + 吸筹完成
   - 信号质量高，成功率较高
   - 兼顾安全性和收益

3. **激进组合**：弹簧策略 + SC反弹
   - 捕捉短期机会
   - 需要严格止损

---

## 🔧 如何使用

### 1. 在 work_flow.py 中启用策略

编辑 `work_flow.py` 文件，在策略字典中添加威克夫策略：

```python
from strategy import (
    # ... 现有策略
    wyckoff_spring,
    wyckoff_divergence,
    wyckoff_selling_climax,
    wyckoff_accumulation,
)

def prepare():
    # ... 现有代码
    
    strategies = {
        # ... 现有策略
        "威克夫-弹簧": wyckoff_spring.check,
        "威克夫-缩量不跌": wyckoff_divergence.check,
        "威克夫-SC反弹": wyckoff_selling_climax.check,
        "威克夫-吸筹完成": wyckoff_accumulation.check,
    }
```

### 2. 运行选股

```bash
python main.py
```

### 3. 查看结果

结果会推送到微信（如已配置）和日志文件 `sequoia.log`。

---

## 💡 使用技巧

### 1. 结合大盘环境

- **牛市/震荡市**：所有策略成功率较高
- **熊市**：优先使用"吸筹完成"和"量价背离"，避免使用"SC反弹"

### 2. 仓位管理

- **弹簧策略**：可重仓（信号清晰）
- **量价背离**：分批建仓（可能还要整理）
- **SC反弹**：轻仓试探（风险大）
- **吸筹完成**：可中等仓位（稳健）

### 3. 止损设置

- **弹簧策略**：跌破箱体底部3%止损
- **量价背离**：跌破整理区间低点止损
- **SC反弹**：跌破ST低点止损
- **吸筹完成**：跌破箱体顶部5%止损

### 4. 加仓时机

- **突破后回踩不破**：最佳加仓点
- **放量突破当天**：可追涨加仓（弹簧和吸筹完成）
- **整理中继**：逐步加仓（量价背离）

### 5. 风险控制

- 单只股票仓位不超过30%
- 同类策略股票不超过3只
- 设置止损，严格执行
- 关注大盘环境，熊市减仓

---

## 📚 深度学习资源

如果想深入学习威克夫理论，推荐以下资源：

### 经典书籍
1. 《威科夫理论》（Studies in Tape Reading）- Richard D. Wyckoff
2. 《股市趋势技术分析》- Robert D. Edwards
3. 《威科夫理论全集》（Master the Markets）- Tom Williams

### 关键概念
- **吸筹阶段**：PS, SC, AR, ST, Spring, SOS, LPS
- **派发阶段**：PSY, BC, AR, ST, UT, UTAD, SOW
- **量价关系**：Volume Spread Analysis (VSA)
- **市场操纵者**：Composite Operator

### 学习路径
1. 理解三大定律
2. 识别市场四个阶段
3. 学习吸筹阶段的各个关键点
4. 学习派发阶段的各个关键点
5. 实践量价分析

---

## 🎓 策略优化建议

### 1. 参数优化
- 可根据不同市场环境调整参数
- 建议通过回测找到最优参数
- 不同行业可能需要不同参数

### 2. 策略组合
- 多个威克夫策略同时选中的股票，信号更强
- 可以与其他技术指标结合（如MACD、RSI）
- 考虑基本面因素（业绩、行业景气度）

### 3. 回测验证
- 使用历史数据回测策略有效性
- 在 `config.yaml` 中设置 `end_date` 进行回测
- 记录每次交易，总结经验

### 4. 实盘优化
- 从小仓位开始
- 记录每个信号的后续表现
- 根据实际效果调整策略权重

---

## ⚠️ 免责声明

1. 本策略仅供学习和研究使用，不构成投资建议
2. 股市有风险，投资需谨慎
3. 任何策略都不能保证100%成功
4. 请根据自身风险承受能力选择合适的策略
5. 建议在充分理解策略原理后再使用
6. 实盘操作前请充分回测和模拟

---

## 📧 反馈与改进

如果你在使用过程中有任何问题或建议，欢迎：

1. 提交 Issue
2. 贡献代码（Pull Request）
3. 分享你的实盘经验
4. 提出策略优化建议

让我们一起完善这套威克夫选股系统！

---

**最后更新：** 2025-12-23  
**版本：** v1.0  
**作者：** Sequoia Team


